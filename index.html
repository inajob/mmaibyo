<html>
  <head>
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <script src="js/socket.io.js"></script>
    <style>
      *{
        padding:0px;
        margin:0px;
      }
      div{
      }
      div img{
        width:100%;
        height:auto;
      }
    </style>
    <script>
      <!--
      function $(id){
        return document.getElementById(id);
      }
      function $c(name){
        return document.createElement(name)
      }
      function $t(text){
        return document.createTextNode(text);
      }

      var queue = [];
      
      function update(url){
        //console.log(url);
        if(url.media.length > 0){
          var piece = $c("div");
          var img = $c("img");
          img.src = url.media[0]
          img.onload = function(){
            var tdiv = $c('div');
            tdiv.appendChild($t(url.title))
            piece.appendChild(tdiv);
            var idiv = $c('div')
            idiv.appendChild(img);
            piece.appendChild($c('div').appendChild(img));
            queue.push(piece);
          };
        }
      }
      setInterval(function(){
        var debug = $("debug");
        var p = queue.shift();
        if(p){
          debug.innerHTML = "";
          debug.appendChild(p);
        }
      },500);

      var socket = io.connect('http://nodejs-maibyo.rhcloud.com:8000');
      socket.on('message', function(t) {
        //console.log('onmessage',t);
        if(t.type && t.type=="init"){
          // initialize
          var urls = t.urls;
          for(var i = 0; i < Math.min(10,urls.length); i++){
            update(urls[i])
          }
        }else{
          //console.log(t);
          update(t);
        }
      });

      -->
    </script>
  </head>
  <body>
    <h1>maibyo</h1>
    <div id="debug"></div>
  </body>
</html>
